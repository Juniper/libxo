
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Howtos: Focused Directions &#8212; libxo 1.1.0
 documentation</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="example.html" />
    <link rel="prev" title="FAQs" href="faq.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="example.html" title="Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="FAQs"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">libxo 1.1.0
 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">On This Page</a></h3>
  <ul>
<li><a class="reference internal" href="#">Howtos: Focused Directions</a><ul>
<li><a class="reference internal" href="#howto-report-bugs">Howto: Report bugs</a></li>
<li><a class="reference internal" href="#howto-install-libxo">Howto: Install libxo</a></li>
<li><a class="reference internal" href="#howto-convert-command-line-applications">Howto: Convert command line applications</a><ul>
<li><a class="reference internal" href="#setting-up-the-context">Setting up the context</a></li>
<li><a class="reference internal" href="#converting-printf-calls">Converting printf Calls</a></li>
<li><a class="reference internal" href="#creating-hierarchy">Creating Hierarchy</a></li>
<li><a class="reference internal" href="#converting-error-functions">Converting Error Functions</a></li>
<li><a class="reference internal" href="#call-xo-finish">Call xo_finish</a></li>
</ul>
</li>
<li><a class="reference internal" href="#howto-use-xo-in-shell-scripts">Howto: Use “xo” in Shell Scripts</a></li>
<li><a class="reference internal" href="#howto-internationalization-i18n">Howto: Internationalization (i18n)</a><ul>
<li><a class="reference internal" href="#i18n-and-xo-emit">i18n and xo_emit</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3><a href="index.html">Full Documentation</a></h3>
  <h4>Previous topic</h4>
  <p class="topless"><a href="faq.html"
                        title="previous chapter">FAQs</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="example.html"
                        title="next chapter">Examples</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/howto.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="howtos-focused-directions">
<h1>Howtos: Focused Directions<a class="headerlink" href="#howtos-focused-directions" title="Permalink to this headline">¶</a></h1>
<p>This section provides task-oriented instructions for selected tasks.
If you have a task that needs instructions, please open a request as
an enhancement issue on github.</p>
<div class="section" id="howto-report-bugs">
<h2>Howto: Report bugs<a class="headerlink" href="#howto-report-bugs" title="Permalink to this headline">¶</a></h2>
<p>libxo uses github to track bugs or request enhancements.  Please use
the following URL:</p>
<blockquote>
<div><a class="reference external" href="https://github.com/Juniper/libxo/issues">https://github.com/Juniper/libxo/issues</a></div></blockquote>
</div>
<div class="section" id="howto-install-libxo">
<h2>Howto: Install libxo<a class="headerlink" href="#howto-install-libxo" title="Permalink to this headline">¶</a></h2>
<p>libxo is open source, under a new BSD license.  Source code is
available on github, as are recent releases.  To get the most
current release, please visit:</p>
<blockquote>
<div><a class="reference external" href="https://github.com/Juniper/libxo/releases">https://github.com/Juniper/libxo/releases</a></div></blockquote>
<p>After downloading and untarring the source code, building involves the
following steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sh</span> <span class="nb">bin</span><span class="o">/</span><span class="n">setup</span><span class="o">.</span><span class="n">sh</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="o">../</span><span class="n">configure</span>
<span class="n">make</span>
<span class="n">make</span> <span class="n">test</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>libxo uses a distinct “<em>build</em>” directory to keep generated files
separated from source files.</p>
<p id="index-0">Use “<code class="code docutils literal notranslate"><span class="pre">../configure</span> <span class="pre">--help</span></code>” to display available configuration
options, which include the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">warnings</span>      <span class="n">Turn</span> <span class="n">on</span> <span class="n">compiler</span> <span class="n">warnings</span>
<span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">debug</span>         <span class="n">Turn</span> <span class="n">on</span> <span class="n">debugging</span>
<span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">text</span><span class="o">-</span><span class="n">only</span>     <span class="n">Turn</span> <span class="n">on</span> <span class="n">text</span><span class="o">-</span><span class="n">only</span> <span class="n">rendering</span>
<span class="o">--</span><span class="n">enable</span><span class="o">-</span><span class="n">printflike</span>    <span class="n">Enable</span> <span class="n">use</span> <span class="n">of</span> <span class="n">GCC</span> <span class="n">__printflike</span> <span class="n">attribute</span>
<span class="o">--</span><span class="n">disable</span><span class="o">-</span><span class="n">libxo</span><span class="o">-</span><span class="n">options</span>  <span class="n">Turn</span> <span class="n">off</span> <span class="n">support</span> <span class="k">for</span> <span class="n">LIBXO_OPTIONS</span>
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">gettext</span><span class="o">=</span><span class="n">PFX</span>     <span class="n">Specify</span> <span class="n">location</span> <span class="n">of</span> <span class="n">gettext</span> <span class="n">installation</span>
<span class="o">--</span><span class="k">with</span><span class="o">-</span><span class="n">libslax</span><span class="o">-</span><span class="n">prefix</span><span class="o">=</span><span class="n">PFX</span>  <span class="n">Specify</span> <span class="n">location</span> <span class="n">of</span> <span class="n">libslax</span> <span class="n">config</span>
</pre></div>
</div>
<p>Compiler warnings are a very good thing, but recent compiler version
have added some very pedantic checks.  While every attempt is made to
keep libxo code warning-free, warnings are now optional.  If you are
doing development work on libxo, it is required that you
use –enable-warnings to keep the code warning free, but most users
need not use this option.</p>
<p id="index-1">libxo provides the <code class="code docutils literal notranslate"><span class="pre">--enable-text-only</span></code> option to reduce the
footprint of the library for smaller installations.  XML, JSON, and
HTML rendering logic is removed.</p>
<p id="index-2">The gettext library does not provide a simple means of learning its
location, but libxo will look for it in /usr and /opt/local.  If
installed elsewhere, the installer will need to provide this
information using the “<code class="code docutils literal notranslate"><span class="pre">--with-gettext=/dir/path</span></code>” option.</p>
<p id="index-3">libslax is not required by libxo; it contains the “oxtradoc” program
used to format documentation.</p>
<p>For additional information, see <a class="reference internal" href="getting.html#building"><span class="std std-ref">Building libxo</span></a>.</p>
</div>
<div class="section" id="howto-convert-command-line-applications">
<h2>Howto: Convert command line applications<a class="headerlink" href="#howto-convert-command-line-applications" title="Permalink to this headline">¶</a></h2>
<p>Common question: How do I convert an existing command line application?</p>
<p>There are four basic steps for converting command line application to
use libxo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">Setting</span> <span class="n">up</span> <span class="n">the</span> <span class="n">context</span>
<span class="o">-</span> <span class="n">Converting</span> <span class="n">printf</span> <span class="n">calls</span>
<span class="o">-</span> <span class="n">Creating</span> <span class="n">hierarchy</span>
<span class="o">-</span> <span class="n">Converting</span> <span class="n">error</span> <span class="n">functions</span>
</pre></div>
</div>
<div class="section" id="setting-up-the-context">
<h3>Setting up the context<a class="headerlink" href="#setting-up-the-context" title="Permalink to this headline">¶</a></h3>
<p>To use libxo, you’ll need to include the “xo.h” header file in your
source code files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;libxo/xo.h&gt;</span>
</pre></div>
</div>
<p>In your main() function, you’ll need to call xo_parse_args to handling
argument parsing (<a class="reference internal" href="api.html#xo-parse-args"><span class="std std-ref">Parsing Command-line Arguments (xo_parse_args)</span></a>).  This function removes
libxo-specific arguments the program’s argv and returns either the
number of remaining arguments or -1 to indicate an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span>
<span class="n">main</span> <span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">argc</span> <span class="o">=</span> <span class="n">xo_parse_args</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">argc</span><span class="p">;</span>
    <span class="o">....</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="index-4"></span><p id="index-5">At the bottom of your main(), you’ll need to call xo_finish() to
complete output processing for the default handle (<a class="reference internal" href="api.html#handles"><span class="std std-ref">Handles</span></a>).  This
is required to flush internal information buffers.  libxo provides the
xo_finish_atexit function that is suitable for use with the
<em class="manpage">atexit(3)</em> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atexit</span><span class="p">(</span><span class="n">xo_finish_atexit</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="converting-printf-calls">
<h3>Converting printf Calls<a class="headerlink" href="#converting-printf-calls" title="Permalink to this headline">¶</a></h3>
<p>The second task is inspecting code for <em class="manpage">printf(3)</em> calls and
replacing them with xo_emit() calls.  The format strings are similar
in task, but libxo format strings wrap output fields in braces.  The
following two calls produce identical text output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;There are </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> events</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">etype</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;There are {:count/</span><span class="si">%d</span><span class="s2">} {:event} events</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">etype</span><span class="p">);</span>
</pre></div>
</div>
<p>“count” and “event” are used as names for JSON and XML output.  The
“count” field uses the format “%d” and “event” uses the default “%s”
format.  Both are “value” roles, which is the default role.</p>
<p>Since text outside of output fields is passed verbatim, other roles
are less important, but their proper use can help make output more
useful.  The “note” and “label” roles allow HTML output to recognize
the relationship between text and the associated values, allowing
appropriate “hover” and “onclick” behavior.  Using the “units” role
allows the presentation layer to perform conversions when needed.  The
“warning” and “error” roles allows use of color and font to draw
attention to warnings.  The “padding” role makes the use of vital
whitespace more clear (<a class="reference internal" href="field-roles.html#padding-role"><span class="std std-ref">The Padding Role ({P:})</span></a>).</p>
<p>The “<em>title</em>” role indicates the headings of table and sections.  This
allows HTML output to use CSS to make this relationship more obvious:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Statistics:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{T:Statistics}:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The “<em>color</em>” roles controls foreground and background colors, as well
as effects like bold and underline (see <a class="reference internal" href="field-roles.html#color-role"><span class="std std-ref">The Color Role ({C:})</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{C:bold}required</span><span class="si">{C:}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Finally, the start- and stop-anchor roles allow justification and
padding over multiple fields (see <a class="reference internal" href="field-roles.html#anchor-role"><span class="std std-ref">The Anchor Roles ({[:} and {]:})</span></a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="s2">&quot;(</span><span class="si">%u</span><span class="s2">/</span><span class="si">%u</span><span class="s2">/</span><span class="si">%u</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="n">ave</span><span class="p">,</span> <span class="nb">max</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%30s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{[:30}({:minimum/</span><span class="si">%u</span><span class="s2">}/{:average/</span><span class="si">%u</span><span class="s2">}/{:maximum/</span><span class="si">%u</span><span class="s2">}{]:}&quot;</span><span class="p">,</span>
          <span class="nb">min</span><span class="p">,</span> <span class="n">ave</span><span class="p">,</span> <span class="nb">max</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-hierarchy">
<h3>Creating Hierarchy<a class="headerlink" href="#creating-hierarchy" title="Permalink to this headline">¶</a></h3>
<p>Text output doesn’t have any sort of hierarchy, but XML and JSON
require this.  Typically applications use indentation to represent
these relationship:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;table </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tnum</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;    </span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">);</span>
  <span class="p">}</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{T:/table </span><span class="si">%d</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tnum</span><span class="p">);</span>
  <span class="n">xo_open_list</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">xo_open_instance</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">);</span>
      <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{P:    }{k:name} {:size/</span><span class="si">%d</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
              <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">);</span>
      <span class="n">xo_close_instance</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">xo_close_list</span><span class="p">(</span><span class="s2">&quot;table&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>The open and close list functions are used before and after the list,
and the open and close instance functions are used before and after
each instance with in the list.</p>
<p>Typically these developer looks for a “for” loop as an indication of
where to put these calls.</p>
<p>In addition, the open and close container functions allow for
organization levels of hierarchy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;Paging information:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;    Free:      </span><span class="si">%lu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">free</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;    Active:    </span><span class="si">%lu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;    Inactive:  </span><span class="si">%lu</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">inactive</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_open_container</span><span class="p">(</span><span class="s2">&quot;paging-information&quot;</span><span class="p">);</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{P:    }{L:Free:      }{:free/</span><span class="si">%lu</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">free</span><span class="p">);</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{P:    }{L:Active:    }{:active/</span><span class="si">%lu</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">);</span>
  <span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{P:    }{L:Inactive:  }{:inactive/</span><span class="si">%lu</span><span class="s2">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">inactive</span><span class="p">);</span>
  <span class="n">xo_close_container</span><span class="p">(</span><span class="s2">&quot;paging-information&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="converting-error-functions">
<h3>Converting Error Functions<a class="headerlink" href="#converting-error-functions" title="Permalink to this headline">¶</a></h3>
<p>libxo provides variants of the standard error and warning functions,
<em class="manpage">err(3)</em> and <em class="manpage">warn(3)</em>.  There are two variants, one
for putting the errors on standard error, and the other writes the
errors and warnings to the handle using the appropriate encoding
style:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;cannot open output file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;cannot open output file: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
  <span class="n">xo_emit_err</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;cannot open output file: {:filename}&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="call-xo-finish">
<span id="index-6"></span><h3>Call xo_finish<a class="headerlink" href="#call-xo-finish" title="Permalink to this headline">¶</a></h3>
<p>One important item: call <code class="code docutils literal notranslate"><span class="pre">xo_finish</span></code> at the end of your program so
ensure that all buffered data is written out.  You can call it
explicitly call it, or use <em class="manpage">atexit(3)</em> to have
<code class="code docutils literal notranslate"><span class="pre">xo_finish_atexit</span></code> called implicitly on exit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">OLD</span><span class="p">::</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="n">NEW</span><span class="p">::</span>
  <span class="n">xo_finish</span><span class="p">();</span>
  <span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="howto-use-xo-in-shell-scripts">
<h2>Howto: Use “xo” in Shell Scripts<a class="headerlink" href="#howto-use-xo-in-shell-scripts" title="Permalink to this headline">¶</a></h2>
<div class="admonition-needed admonition">
<p class="first admonition-title">Needed</p>
<p class="last">Documentation is needed for this area.</p>
</div>
<span class="target" id="index-7"></span><span class="target" id="index-8"></span></div>
<div class="section" id="howto-internationalization-i18n">
<span id="i18n"></span><span id="index-9"></span><h2>Howto: Internationalization (i18n)<a class="headerlink" href="#howto-internationalization-i18n" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div>How do I use libxo to support internationalization?</div></blockquote>
<p>libxo allows format and field strings to be used a keys into message
catalogs to enable translation into a user’s native language by
invoking the standard <em class="manpage">gettext(3)</em> functions.</p>
<p>gettext setup is a bit complicated: text strings are extracted from
source files into “<em>portable object template</em>” (.pot) files using the
<code class="code docutils literal notranslate"><span class="pre">xgettext</span></code> command.  For each language, this template file is used as
the source for a message catalog in the “<em>portable object</em>” (.po)
format, which are translated by hand and compiled into “<em>machine
object</em>” (.mo) files using the <code class="code docutils literal notranslate"><span class="pre">msgfmt</span></code> command.  The .mo files are
then typically installed in the /usr/share/locale or
/opt/local/share/locale directories.  At run time, the user’s language
settings are used to select a .mo file which is searched for matching
messages.  Text strings in the source code are used as keys to look up
the native language strings in the .mo file.</p>
<p>Since the xo_emit format string is used as the key into the message
catalog, libxo removes unimportant field formatting and modifiers from
the format string before use so that minor formatting changes will not
impact the expensive translation process.  We don’t want a developer
change such as changing “/%06d” to “/%08d” to force hand inspection of
all .po files.  The simplified version can be generated for a single
message using the <code class="code docutils literal notranslate"><span class="pre">xopo</span> <span class="pre">-s</span> <span class="pre">$text</span></code> command, or an entire .pot can be
translated using the <code class="code docutils literal notranslate"><span class="pre">xopo</span> <span class="pre">-f</span> <span class="pre">$input</span> <span class="pre">-o</span> <span class="pre">$output</span></code> command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EXAMPLE</span><span class="p">:</span>
    <span class="o">%</span> <span class="n">xopo</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&quot;There are {:count/</span><span class="si">%u</span><span class="s2">} {:event/</span><span class="si">%.6s</span><span class="s2">} events</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">There</span> <span class="n">are</span> <span class="p">{:</span><span class="n">count</span><span class="p">}</span> <span class="p">{:</span><span class="n">event</span><span class="p">}</span> <span class="n">events</span>\<span class="n">n</span>

<span class="n">Recommended</span> <span class="n">workflow</span><span class="p">:</span>
    <span class="c1"># Extract text messages</span>
    <span class="n">xgettext</span> <span class="o">--</span><span class="n">default</span><span class="o">-</span><span class="n">domain</span><span class="o">=</span><span class="n">foo</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">wrap</span> \
        <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">comments</span> <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">xo_emit</span> <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">xo_emit_h</span> \
        <span class="o">--</span><span class="n">keyword</span><span class="o">=</span><span class="n">xo_emit_warn</span> <span class="o">-</span><span class="n">C</span> <span class="o">-</span><span class="n">E</span> <span class="o">-</span><span class="n">n</span> <span class="o">--</span><span class="n">foreign</span><span class="o">-</span><span class="n">user</span> \
        <span class="o">-</span><span class="n">o</span> <span class="n">foo</span><span class="o">.</span><span class="n">pot</span><span class="o">.</span><span class="n">raw</span> <span class="n">foo</span><span class="o">.</span><span class="n">c</span>

    <span class="c1"># Simplify format strings for libxo</span>
    <span class="n">xopo</span> <span class="o">-</span><span class="n">f</span> <span class="n">foo</span><span class="o">.</span><span class="n">pot</span><span class="o">.</span><span class="n">raw</span> <span class="o">-</span><span class="n">o</span> <span class="n">foo</span><span class="o">.</span><span class="n">pot</span>

    <span class="c1"># For a new language, just copy the file</span>
    <span class="n">cp</span> <span class="n">foo</span><span class="o">.</span><span class="n">pot</span> <span class="n">po</span><span class="o">/</span><span class="n">LC</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">po</span>

    <span class="c1"># For an existing language:</span>
    <span class="n">msgmerge</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">wrap</span> <span class="n">po</span><span class="o">/</span><span class="n">LC</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">po</span> \
            <span class="n">foo</span><span class="o">.</span><span class="n">pot</span> <span class="o">-</span><span class="n">o</span> <span class="n">po</span><span class="o">/</span><span class="n">LC</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">po</span><span class="o">.</span><span class="n">new</span>

    <span class="c1"># Now the hard part: translate foo.po using tools</span>
    <span class="c1"># like poedit or emacs&#39; po-mode</span>

    <span class="c1"># Compile the finished file; Use of msgfmt&#39;s &quot;-v&quot; option is</span>
    <span class="c1"># strongly encouraged, so that &quot;fuzzy&quot; entries are reported.</span>
    <span class="n">msgfmt</span> <span class="o">-</span><span class="n">v</span> <span class="o">-</span><span class="n">o</span> <span class="n">po</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">LC_MESSAGES</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">mo</span> <span class="n">po</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">po</span>

    <span class="c1"># Install the .mo file</span>
    <span class="n">sudo</span> <span class="n">cp</span> <span class="n">po</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">LC_MESSAGES</span><span class="o">/</span><span class="n">foo</span><span class="o">.</span><span class="n">mo</span> \
            <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">locale</span><span class="o">/</span><span class="n">my_lang</span><span class="o">/</span><span class="n">LC_MESSAGE</span><span class="o">/</span>
</pre></div>
</div>
<p>Once these steps are complete, you can use the <code class="code docutils literal notranslate"><span class="pre">gettext</span></code> command to
test the message catalog:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gettext</span> <span class="o">-</span><span class="n">d</span> <span class="n">foo</span> <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;some text&quot;</span>
</pre></div>
</div>
<div class="section" id="i18n-and-xo-emit">
<h3>i18n and xo_emit<a class="headerlink" href="#i18n-and-xo-emit" title="Permalink to this headline">¶</a></h3>
<p>There are three features used in libxo used to support i18n:</p>
<ul class="simple">
<li>The “{G:}” role looks for a translation of the format string.</li>
<li>The “{g:}” modifier looks for a translation of the field.</li>
<li>The “{p:}” modifier looks for a pluralized version of the field.</li>
</ul>
<p>Together these three flags allows a single function call to give
native language support, as well as libxo’s normal XML, JSON, and HTML
support:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printf</span><span class="p">(</span><span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;Received %zu </span><span class="si">%s</span><span class="s2"> from {g:server} server</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
       <span class="n">counter</span><span class="p">,</span> <span class="n">ngettext</span><span class="p">(</span><span class="s2">&quot;byte&quot;</span><span class="p">,</span> <span class="s2">&quot;bytes&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">),</span>
       <span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;web&quot;</span><span class="p">));</span>

<span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{G:}</span><span class="s2">Received {:received/%zu} {Ngp:byte,bytes} &quot;</span>
        <span class="s2">&quot;from {g:server} server</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">,</span> <span class="s2">&quot;web&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>libxo will see the “{G:}” role and will first simplify the format
string, removing field formats and modifiers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Received {:received} {N:byte,bytes} from {:server} server</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>libxo calls <em class="manpage">gettext(3)</em> with that string to get a localized
version.  If your language were <em>Pig Latin</em>, the result might look
like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Eceivedray {:received} {N:byte,bytes} omfray &quot;</span>
           <span class="s2">&quot;{:server} erversay</span><span class="se">\n</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>Note the field names do not change and they should not be translated.
The contents of the note (“byte,bytes”) should also not be translated,
since the “g” modifier will need the untranslated value as the key for
the message catalog.</p>
<p>The field “{g:server}” requests the rendered value of the field be
translated using <em class="manpage">gettext(3)</em>.  In this example, “web” would
be used.</p>
<p>The field “{Ngp:byte,bytes}” shows an example of plural form using the
“{p:}” modifier with the “{g:}” modifier.  The base singular and plural
forms appear inside the field, separated by a comma.  At run time,
libxo uses the previous field’s numeric value to decide which form to
use by calling <em class="manpage">ngettext(3)</em>.</p>
<p>If a domain name is needed, it can be supplied as the content of the
{G:} role.  Domain names remain in use throughout the format string
until cleared with another domain name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printf</span><span class="p">(</span><span class="n">dgettext</span><span class="p">(</span><span class="s2">&quot;dns&quot;</span><span class="p">,</span> <span class="s2">&quot;Host </span><span class="si">%s</span><span class="s2"> not found: </span><span class="si">%d</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="n">name</span><span class="p">,</span> <span class="n">errno</span><span class="p">,</span> <span class="n">dgettext</span><span class="p">(</span><span class="s2">&quot;strerror&quot;</span><span class="p">,</span> <span class="n">strerror</span><span class="p">(</span><span class="n">errno</span><span class="p">)));</span>

<span class="n">xo_emit</span><span class="p">(</span><span class="s2">&quot;{G:dns}Host {:hostname} not found: &quot;</span>
        <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">({G:strerror}{g:%m})</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">errno</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="example.html" title="Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="faq.html" title="FAQs"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">libxo 1.1.0
 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017-2019, Juniper Networks.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>